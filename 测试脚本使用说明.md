# ZBProxy配置更新测试脚本使用说明

我为您创建了两个Python测试脚本来测试ZBProxy管理API的配置更新功能。

## 📁 文件说明

### 1. `test_config_update.py` - 完整测试脚本
这是一个功能完整的测试脚本，包含：
- ✅ 基本配置更新测试
- ✅ 服务配置更新测试  
- ✅ 出站配置更新测试
- ✅ 复杂配置更新测试
- ✅ 无效配置更新测试
- ✅ API连接性测试
- ✅ 交互式测试模式

### 2. `quick_test.py` - 快速测试脚本
这是一个简化的测试脚本，用于快速验证基本的配置更新功能。

## 🚀 使用方法

### 前提条件
确保ZBProxy管理API正在运行：
```bash
python main.py
```

### 运行完整测试
```bash
# 运行自动化测试
python test_config_update.py

# 运行交互式测试
python test_config_update.py --interactive
```

### 运行快速测试
```bash
python quick_test.py
```

## 🧪 测试内容

### 基本配置测试
- 修改日志级别 (`Log.Level`)
- 修改默认出站 (`Router.DefaultOutbound`)

### 服务配置测试
- 修改监听端口 (`Services.0.Listen`)
- 修改IP访问模式 (`Services.0.IPAccess.Mode`)

### 出站配置测试
- 修改目标地址 (`Outbounds.0.TargetAddress`)
- 修改目标端口 (`Outbounds.0.TargetPort`)
- 修改Minecraft相关设置

### 复杂配置测试
- 更新嵌套对象
- 修改MOTD描述
- 更新路由规则

### 错误处理测试
- 测试不存在的路径
- 测试无效的数组索引
- 测试无效的值类型

## 📊 输出示例

```
🚀 ZBProxy配置更新测试脚本
🔗 API地址: http://localhost:8000

============================================================
 API连接性测试 
============================================================

🔧 连接根路径
状态码: 200
响应: {
  "message": "ZBProxy管理API",
  "version": "1.0.0"
}
✅ 操作成功

============================================================
 基本配置更新测试 
============================================================

📋 测试: 修改日志级别为debug

🔧 获取配置值: Log.Level
状态码: 200
响应: {
  "success": true,
  "path": "Log.Level",
  "value": "info"
}
✅ 操作成功

🔧 更新配置 Log.Level = debug (修改日志级别为debug)
状态码: 200
响应: {
  "success": true,
  "message": "配置已更新: Log.Level = debug"
}
✅ 操作成功
```

## 🔧 自定义测试

### 在交互式模式中
```bash
python test_config_update.py --interactive
```

然后选择操作：
1. 获取完整配置
2. 获取指定路径配置值
3. 更新配置值
4. 运行预设测试
5. 退出

### 修改测试用例
您可以编辑 `test_config_update.py` 中的测试用例：

```python
test_cases = [
    ("Log.Level", "debug", "修改日志级别为debug"),
    ("Services.0.Listen", 25566, "修改服务端口"),
    # 添加您的测试用例
]
```

## ⚠️ 注意事项

1. **备份配置**: 运行测试前建议备份 `ZBProxy.json` 文件
2. **API运行**: 确保ZBProxy管理API在 `http://localhost:8000` 运行
3. **权限问题**: 确保有权限读写配置文件
4. **网络连接**: 确保能连接到API服务
5. **配置恢复**: 测试脚本会尝试恢复某些配置，但不保证完全恢复

## 🐛 故障排除

### 连接失败
```
❌ API连接失败: Connection refused
```
**解决方案**: 确保API服务正在运行

### 权限错误
```
❌ 保存配置文件失败: Permission denied
```
**解决方案**: 检查文件权限或以管理员身份运行

### 配置路径错误
```
❌ 路径不存在: NonExistent.Path
```
**解决方案**: 检查配置路径是否正确

## 📈 扩展功能

您可以根据需要扩展测试脚本：

1. **添加新的测试用例**
2. **集成到CI/CD流程**
3. **添加性能测试**
4. **添加并发测试**
5. **生成测试报告**

## 🤝 使用建议

1. **开发环境**: 在开发环境中使用完整测试脚本
2. **生产环境**: 谨慎使用，建议先在测试环境验证
3. **定期测试**: 可以定期运行快速测试验证API功能
4. **日志监控**: 结合ZBProxy日志监控测试效果
